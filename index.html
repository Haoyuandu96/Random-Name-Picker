<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Random Name Picker ‚Äî Grouped</title>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--ink:#e5e7eb;--muted:#9ca3af;--accent:#22c55e;--accent-2:#3b82f6;--danger:#ef4444;--card:#1f2937;--chip:#0ea5e9}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans';
      background: radial-gradient(1200px 600px at 80% -10%, rgba(59,130,246,.2), transparent 60%),
                  radial-gradient(1000px 500px at -10% 90%, rgba(34,197,94,.16), transparent 60%), var(--bg); color:var(--ink)}
    .wrap{max-width:1150px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:16px}
    h1{font-size:clamp(24px,2.4vw,34px);margin:0;letter-spacing:.4px}
    .sub{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:16px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:rgba(17,24,39,.7);border:1px solid rgba(255,255,255,.06);box-shadow:0 10px 30px rgba(0,0,0,.35);border-radius:18px;padding:14px;backdrop-filter:blur(6px)}
    textarea{width:100%;min-height:190px;background:var(--card);color:var(--ink);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;resize:vertical;font-size:14px;line-height:1.4}
    .muted{color:var(--muted);font-size:13px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .row.space{justify-content:space-between}
    button{appearance:none;border:1px solid transparent;border-radius:12px;padding:9px 12px;font-weight:600;cursor:pointer;transition:transform .04s,box-shadow .2s,opacity .2s,background .2s,border-color .2s;font-size:14px;
      background:#0b1220;color:var(--ink);border-color:rgba(255,255,255,.08);box-shadow:0 2px 0 rgba(255,255,255,.05) inset,0 6px 14px rgba(0,0,0,.3)}
    button:hover{transform:translateY(-1px)} button:active{transform:translateY(0)}
    button.primary{background:linear-gradient(180deg,#1a8a46,#0f6a35)}
    button.blue{background:linear-gradient(180deg,#3b82f6,#1d4ed8)}
    button.warn{background:linear-gradient(180deg,#ef4444,#b91c1c)}
    button.ghost{background:transparent}
    button:disabled{opacity:.55;cursor:not-allowed}
    select, input[type=text]{background:var(--card);color:var(--ink);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px 10px}
    .columns{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:800px){.columns{grid-template-columns:1fr}}
    .list{display:grid;gap:8px;max-height:340px;overflow:auto;padding-right:4px}
    .chip{display:inline-flex;align-items:center;gap:8px;background:rgba(14,165,233,.12);border:1px solid rgba(14,165,233,.25);color:#e0f2fe;padding:8px 10px;border-radius:999px;font-size:13px}
    .chip .x{background:transparent;border:none;color:#e0f2fe;cursor:pointer;padding:0;margin-left:4px;font-weight:700}
    .pill{padding:6px 10px;border-radius:999px;border:1px dashed rgba(255,255,255,.15);font-size:12px;color:var(--muted);background:rgba(255,255,255,.02)}
    .winner{font-size:clamp(22px,3vw,36px);text-align:center;background:linear-gradient(90deg,#93c5fd,#86efac);-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:800;letter-spacing:.4px;padding:10px 0;min-height:48px}
    .footer{margin-top:8px;text-align:center;font-size:12px;color:var(--muted)}
    .group-list{display:grid;gap:6px;max-height:360px;overflow:auto}
    .group-item{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px 10px;font-size:13px}
    .badge{font-family:ui-monospace,Menlo,Consolas,monospace;color:#cbd5e1}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>üé≤ Random Name Picker ‚Äî Grouped</h1>
        <div class="sub">Select a group to draw from, or draw one from each group.</div>
      </div>
      <div class="row">
        <button id="saveBtn" class="blue">üíæ Save</button>
        <button id="loadBtn">üìÇ Load</button>
        <button id="resetBtn" class="warn">‚ôªÔ∏è Reset</button>
      </div>
    </header>

    <div class="grid">
      <!-- Left: Groups & Input -->
      <section class="card">
        <strong>Groups</strong>
        <div class="group-list" id="groupList"></div>
        <hr style="border-color:rgba(255,255,255,.08);margin:12px 0">
        <div class="row space" style="margin-bottom:6px">
          <div><strong>Add/Replace Names in Selected Group</strong><div class="muted">One per line. Click ‚ÄúUse for Group‚Äù.</div></div>
          <div class="row">
            <button id="clearInput" class="ghost">üßπ Clear</button>
          </div>
        </div>
        <textarea id="namesInput" placeholder="Alice&#10;Bob&#10;Charlie"></textarea>
        <div class="row" style="margin-top:8px">
          <button id="useForGroupBtn" class="primary">Use for Group</button>
          <span class="badge">Selected: <strong id="selectedGroupLabel">‚Äî</strong></span>
        </div>
      </section>

      <!-- Right: Draw & Lists -->
      <section class="card">
        <div class="row space">
          <div>
            <strong>Draw</strong>
            <div class="muted">Pick randomly from the selected group.</div>
          </div>
          <div class="row">
            <button id="undoBtn">‚Ü©Ô∏è Undo</button>
            <button id="exportBtn">‚¨áÔ∏è Export</button>
            <input type="file" id="importFile" accept="application/json" style="display:none">
            <button id="importBtn">‚¨ÜÔ∏è Import</button>
          </div>
        </div>

        <div class="row" style="gap:10px;margin:8px 0">
          <select id="groupSelect"></select>
          <button id="drawBtn" class="primary">üéâ Draw (Selected)</button>
          <button id="drawRoundBtn">Draw 1 From Each Group</button>
          <button id="clearRemainingBtn" class="warn">üóëÔ∏è Clear Remaining (Selected)</button>
        </div>

        <div class="winner" id="winner">‚Äî</div>

        <div class="columns">
          <div>
            <div class="muted" style="margin-bottom:6px">Remaining (<span id="remainingCount">0</span>)</div>
            <div class="card list" id="remainingList" style="padding:10px"></div>
          </div>
          <div>
            <div class="muted" style="margin-bottom:6px">Picked (<span id="pickedCount">0</span>)</div>
            <div class="card list" id="pickedList" style="padding:10px"></div>
          </div>
        </div>

        <div class="footer">Tip: Export to save your grouped progress and re-import later.</div>
      </section>
    </div>
  </div>

  <script>
    const LS_KEY = 'grouped-name-picker:v1';
    let state = { mode:'grouped', groups:{}, history:[] };

    const els = {
      namesInput: document.getElementById('namesInput'),
      useForGroupBtn: document.getElementById('useForGroupBtn'),
      selectedGroupLabel: document.getElementById('selectedGroupLabel'),
      groupSelect: document.getElementById('groupSelect'),
      groupList: document.getElementById('groupList'),
      drawBtn: document.getElementById('drawBtn'),
      drawRoundBtn: document.getElementById('drawRoundBtn'),
      clearRemainingBtn: document.getElementById('clearRemainingBtn'),
      undoBtn: document.getElementById('undoBtn'),
      winner: document.getElementById('winner'),
      remainingList: document.getElementById('remainingList'),
      pickedList: document.getElementById('pickedList'),
      remainingCount: document.getElementById('remainingCount'),
      pickedCount: document.getElementById('pickedCount'),
      resetBtn: document.getElementById('resetBtn'),
      clearInput: document.getElementById('clearInput'),
      saveBtn: document.getElementById('saveBtn'),
      loadBtn: document.getElementById('loadBtn'),
      exportBtn: document.getElementById('exportBtn'),
      importBtn: document.getElementById('importBtn'),
      importFile: document.getElementById('importFile')
    };

    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
    function load(){ try{ const s = JSON.parse(localStorage.getItem(LS_KEY)); if(s && s.mode) state = s; }catch(e){} }

    function ensureGroup(name){
      if(!state.groups[name]){
        state.groups[name] = { original:[], remaining:[], picked:[] };
      }
    }

    function setGroupFromList(gname, list){
      ensureGroup(gname);
      state.groups[gname].original = [...list];
      state.groups[gname].remaining = [...list];
      state.groups[gname].picked = [];
      state.history.push({type:'setGroup', group:gname, count:list.length});
      render(); save();
    }

    function currentGroup(){ return els.groupSelect.value; }

    function drawOneFromGroup(g){
      const grp = state.groups[g]; if(!grp || grp.remaining.length===0) return;
      const idx = Math.floor(Math.random()*grp.remaining.length);
      const name = grp.remaining.splice(idx,1)[0];
      grp.picked.unshift(name);
      state.history.push({type:'draw', group:g, name, idx});
      render(g, name); save();
    }

    function drawRound(){
      Object.keys(state.groups).forEach(g=>{
        if(state.groups[g].remaining.length>0){
          drawOneFromGroup(g);
        }
      });
    }

    function clearRemaining(g){
      const grp = state.groups[g]; if(!grp || grp.remaining.length===0) return;
      if(!confirm('Clear ALL remaining in '+g+'?')) return;
      grp.remaining = [];
      state.history.push({type:'clearRemaining', group:g});
      render(); save();
    }

    function undo(){
      const last = state.history.pop(); if(!last) return;
      if(last.type==='draw'){
        const grp = state.groups[last.group];
        const pIdx = grp.picked.indexOf(last.name);
        if(pIdx!==-1) grp.picked.splice(pIdx,1);
        if(last.idx <= grp.remaining.length) grp.remaining.splice(last.idx,0,last.name);
        else grp.remaining.push(last.name);
      } else if(last.type==='setGroup'){
        // no-op undo for now
      } else if(last.type==='clearRemaining'){
        // cannot restore without snapshot; keeping it simple
      }
      render(); save();
    }

    function render(selected, highlightName){
      // Build group dropdown + sidebar
      const names = Object.keys(state.groups);
      els.groupSelect.innerHTML = names.map(n=>`<option value="${n}">${n}</option>`).join('');
      if(!selected){ selected = els.groupSelect.value || names[0] || ''; }
      if(selected && !state.groups[selected]) ensureGroup(selected);
      els.groupSelect.value = selected || '';

      els.groupList.innerHTML = names.map(n=>{
        const g = state.groups[n];
        return `<div class="group-item">
                  <span>${n}</span>
                  <span class="badge">R:${g.remaining.length} ¬∑ P:${g.picked.length}</span>
                </div>`;
      }).join('');

      els.selectedGroupLabel.textContent = selected || '‚Äî';

      // Populate remaining/picked for selected
      const grp = state.groups[selected] || {remaining:[], picked:[]};
      els.remainingCount.textContent = grp.remaining.length;
      els.pickedCount.textContent = grp.picked.length;

      els.remainingList.innerHTML = '';
      grp.remaining.forEach(name=>{
        const span = document.createElement('span'); span.className='chip'; span.textContent=name;
        const x = document.createElement('button'); x.className='x'; x.textContent='√ó'; x.title='Remove';
        x.addEventListener('click', ()=>{
          const i = grp.remaining.indexOf(name);
          if(i!==-1){ grp.remaining.splice(i,1); state.history.push({type:'remove', group:selected, name, idx:i}); render(selected); save(); }
        });
        span.appendChild(x); els.remainingList.appendChild(span);
      });

      els.pickedList.innerHTML = '';
      grp.picked.forEach(name=>{
        const pill = document.createElement('span'); pill.className='pill'; pill.textContent=name;
        els.pickedList.appendChild(pill);
      });

      if(highlightName){ els.winner.textContent = highlightName; }
      els.drawBtn.disabled = grp.remaining.length===0;
      els.clearRemainingBtn.disabled = grp.remaining.length===0;
      els.undoBtn.disabled = state.history.length===0;
      els.drawRoundBtn.disabled = names.every(n => state.groups[n].remaining.length===0);
    }

    // Import/Export (supports grouped or legacy flat state)
    function exportState(){
      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='grouped-randomizer-state.json';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }
    function importState(file){
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const obj = JSON.parse(reader.result);
          if(obj.groups){ state = obj; }
          else if(Array.isArray(obj.remaining)){ // legacy flat
            state = { mode:'grouped', groups:{ 'Ungrouped': { original:[...obj.original||obj.remaining], remaining:[...obj.remaining], picked:[...(obj.picked||[])] } }, history:[] };
          } else {
            alert('Unsupported file format'); return;
          }
          render(); save();
        }catch(e){ alert('Could not parse file.'); }
      };
      reader.readAsText(file);
    }

    // Events
    els.groupSelect.addEventListener('change', ()=> render(els.groupSelect.value));
    els.useForGroupBtn.addEventListener('click', ()=>{
      const g = currentGroup() || 'Group 1';
      const list = Array.from(new Set(els.namesInput.value.split(/\\r?\\n/).map(s=>s.trim()).filter(Boolean)));
      setGroupFromList(g, list);
    });
    els.drawBtn.addEventListener('click', ()=> drawOneFromGroup(currentGroup()));
    els.drawRoundBtn.addEventListener('click', drawRound);
    els.clearRemainingBtn.addEventListener('click', ()=> clearRemaining(currentGroup()));
    els.undoBtn.addEventListener('click', undo);
    els.clearInput.addEventListener('click', ()=>{ els.namesInput.value=''; els.namesInput.focus(); });
    els.saveBtn.addEventListener('click', ()=>{ save(); temp('Saved!'); });
    els.loadBtn.addEventListener('click', ()=>{ load(); render(); temp('Loaded!'); });
    els.exportBtn.addEventListener('click', exportState);
    els.importBtn.addEventListener('click', ()=> els.importFile.click());
    els.importFile.addEventListener('change', (e)=>{ const f=e.target.files[0]; if(f) importState(f); e.target.value=''; });

    function temp(msg){
      const b=document.createElement('div'); b.textContent=msg;
      b.style.position='fixed'; b.style.bottom='16px'; b.style.right='16px';
      b.style.padding='10px 14px'; b.style.background='rgba(255,255,255,.08)'; b.style.border='1px solid rgba(255,255,255,.18)'; b.style.borderRadius='10px'; b.style.backdropFilter='blur(6px)';
      document.body.appendChild(b); setTimeout(()=>{ b.style.opacity='0'; b.style.transition='opacity .6s'; },800); setTimeout(()=>b.remove(),1500);
    }

    // Boot: start with empty groups, but if local storage has data, use that
    load();
    if(!state.groups || Object.keys(state.groups).length===0){
      // Initialize with 10 empty groups
      for(let i=1;i<=10;i++){ state.groups['Group '+i] = { original:[], remaining:[], picked:[] }; }
    }
    render(Object.keys(state.groups)[0] || 'Group 1');
  </script>
</body>
</html>
